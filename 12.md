12주차 핵심 기능 구현 (Project: Audio Writer)
1. 오디오 재생 기능
오디오 파일 선택 (_pickAudioFile 함수)

file_picker 패키지를 사용하여 오디오 파일을 선택.
선택된 파일의 경로를 _audioPlayer.setFilePath를 통해 로드.
_selectedFileName 상태 업데이트 및 UI에 파일 이름 표시.
오디오 플레이어 제어 (AudioPlayer 인스턴스: _audioPlayer)

재생/일시정지:
Dart

// _buildAudioPlayerControls() 내 StreamBuilder<PlayerState>
if (playing == true) {
    _audioPlayer.pause();
} else {
    _audioPlayer.play();
}
정지:
Dart

// _buildAudioPlayerControls() 내 IconButton
onPressed: _audioPlayer.stop,
시간 탐색 (Slider 및 10초 이동 버튼):
Dart

// Slider의 onChanged
onChanged: (value) {
    _audioPlayer.seek(Duration(milliseconds: value.toInt()));
}
// 10초 뒤로/앞으로 이동 버튼
onPressed: () {
    final newPosition = (_position.inMilliseconds - 10000).clamp(0, _duration.inMilliseconds).toInt();
    _audioPlayer.seek(Duration(milliseconds: newPosition));
}
// (마찬가지로 +10초 버튼)
재생 상태 및 진행률 업데이트 (_initAudioPlayerListeners 함수)

_audioPlayer.durationStream: 오디오의 총 길이를 _duration에 업데이트.
_audioPlayer.positionStream: 오디오의 현재 재생 위치를 _position에 업데이트하고, 이를 기반으로 슬라이더와 시간 텍스트 (_formatDuration)를 갱신.
2. 가사 작성 및 저장 기능
가사 입력 및 관리 (_currentLineController, _timedLyrics 리스트)

텍스트 입력: TextField (_currentLineController)를 통해 가사를 입력받습니다.
가사 추가 (_addLyric 함수):
입력된 텍스트와 현재 오디오 재생 시간(0ms로 초기화)으로 새로운 가사 ({'text': ..., 'startTimeMilliseconds': 0})를 _timedLyrics 리스트에 추가.
가사 업데이트 (_updateLyric 함수):
_editingLineIndex에 해당하는 기존 가사의 텍스트를 현재 입력 필드의 내용으로 업데이트.
가사 시간 설정 (_setLyricTime 함수)

현재 오디오의 _position.inMilliseconds 값을 선택된 가사의 startTimeMilliseconds에 할당.
선택된 가사 옆의 '시간 기록' (Icons.timer) 버튼을 통해 실행.
가사 수정/삭제 (_startEditingLyric, _deleteLyric 함수)

수정: 선택된 가사의 텍스트를 _currentLineController에 로드하고 _editingLineIndex를 설정하여 수정 모드로 전환.
삭제: _timedLyrics 리스트에서 선택된 가사를 제거.
가사 저장 (_saveLyrics 함수)

HiveService.saveNewLyrics를 호출하여 현재 _timedLyrics 리스트와 _selectedFileName, 현재 시간을 포함하는 Lyrics 객체를 Hive 데이터베이스에 저장.
이미 저장된 가사가 있다면 HiveService.updateLyrics를 통해 업데이트.
가사 불러오기 (_loadSavedLyrics, _loadLyricsFromFile 함수)

오디오 파일 선택 시 자동 로드: _pickAudioFile 시 현재 _selectedFileName과 일치하는 가사가 HiveService.loadLyricsForAudio를 통해 있다면 자동으로 _timedLyrics에 로드.
수동 불러오기 (_loadLyricsFromFile):
file_picker를 통해 .txt 또는 .json 파일을 선택.
선택된 파일의 내용을 파싱하여 _timedLyrics에 로드. (파일 형식에 따라 파싱 로직 포함)
전체 가사 붙여넣기 (_showPasteAllLyricsDialog, _pasteAllLyrics 함수)

텍스트 다이얼로그를 띄워 사용자가 클립보드의 가사를 붙여넣을 수 있도록 함.
붙여넣은 텍스트를 줄바꿈 기준으로 분리하여 _timedLyrics 리스트에 일괄 추가.
3. 오디오 재생 동기화 기능
가사 하이라이팅 (_highlightedLineIndex 변수 및 로직)

_initAudioPlayerListeners 내 _positionSubscription에서 _position이 변경될 때마다 _timedLyrics를 순회.
현재 _position이 각 가사의 startTimeMilliseconds 사이에 있는지 확인하여 _highlightedLineIndex를 업데이트.
UI에서 isSelected ? Colors.lightBlueAccent.withOpacity(0.2) : Colors.grey[800]와 같이 isSelected (index == _highlightedLineIndex) 상태에 따라 가사 배경색을 변경하여 하이라이팅 구현.
가사 자동 스크롤 (_scrollToHighlightedLyric 함수)

_highlightedLineIndex가 변경될 때마다 _listScrollController.animateTo를 사용하여 해당 가사 아이템이 ListView의 중앙에 오도록 스크롤.
