# 14주차 통합 테스트 및 버그 수정 (배포 X)

이번 주차는 구현된 기능들의 통합 테스트를 진행하고 발견된 버그를 수정하는 데 중점을 두었습니다.

## 1. 통합 테스트 시나리오 및 결과

다음과 같은 주요 기능들에 대해 통합 테스트를 진행했으며, 그 과정에서 발견된 버그를 수정했습니다.

* **오디오 파일 선택 및 재생**:
    * **테스트 시나리오**: 다양한 형식의 오디오 파일 (mp3, wav, m4a 등)이 정상적으로 로드되고 재생되는지 확인했습니다.
    * **결과**: 대부분의 파일 형식에서 정상 작동을 확인했습니다. 일부 특정 코덱의 파일에서 로드 실패 케이스가 발견되었으며, 이는 `just_audio` 라이브러리 업데이트 및 관련 예외 처리 로직을 강화하여 수정했습니다.
    * **관련 파일/코드**: `_pickAudioFile` 함수 (lib/screens/home_screen.dart)

* **오디오 재생 컨트롤 (재생/일시정지/정지/탐색)**:
    * **테스트 시나리오**: 오디오 재생 중 일시정지, 정지 후 재시작, 슬라이더를 통한 시간 이동, 10초 앞/뒤 이동이 원활하게 작동하는지 확인했습니다.
    * **결과**: 초기 슬라이더의 반응 속도 및 정확도 문제가 발견되었습니다. `StreamBuilder`의 데이터 흐름 최적화 및 `_audioPlayer.seek` 호출 시 Debounce 기법 적용을 통해 슬라이더의 움직임을 부드럽게 개선했습니다.
    * **관련 파일/코드**: `_buildAudioPlayerControls` 함수 내 `StreamBuilder` 및 `Slider` 로직 (lib/screens/home_screen.dart)

* **가사 입력, 수정, 삭제**:
    * **테스트 시나리오**: 새로운 가사 입력 및 추가, 기존 가사 선택 후 수정, 개별 가사 삭제 기능이 예상대로 작동하는지 확인했습니다.
    * **결과**: 특정 상황에서 가사 수정 후 저장되지 않거나, UI가 즉시 갱신되지 않는 버그가 발견되었습니다. `setState` 호출 누락 및 `_editingLineIndex` 초기화 로직을 수정하여 해결했습니다.
    * **관련 파일/코드**: `_addLyric`, `_updateLyric`, `_deleteLyric` 함수 (lib/screens/home_screen.dart)

* **오디오 시간에 맞춘 가사 하이라이팅 및 자동 스크롤**:
    * **테스트 시나리오**: 오디오 재생 시간에 맞춰 현재 가사가 올바르게 하이라이트되고, `ListView`가 해당 가사로 자동 스크롤되는지 확인했습니다.
    * **결과**: 스크롤 시 깜빡임 현상 및 가사 전환 시점의 미세한 오차가 발생했습니다. 스크롤 애니메이션 최적화 및 하이라이팅 로직의 시간 임계값(`tolerance`) 조정을 통해 개선했습니다.
    * **관련 파일/코드**: `_initAudioPlayerListeners` 내 `_positionSubscription` 로직, `_scrollToHighlightedLyric` 함수 (lib/screens/home_screen.dart)

* **가사 시간 설정**:
    * **테스트 시나리오**: '시간 기록' 버튼을 눌렀을 때 현재 오디오 시간이 정확히 가사에 할당되는지 확인했습니다.
    * **결과**: 정상 작동을 확인했습니다.

* **가사 저장 및 불러오기 (Hive)**:
    * **테스트 시나리오**: 가사를 저장했을 때 데이터가 영구적으로 보존되는지, 앱 재시작 후에도 올바르게 불러와지는지, 오디오 파일과 매칭되어 자동 로드되는지 확인했습니다.
    * **결과**: 안정적인 데이터 저장 및 로드를 확인했습니다. `HiveService`의 `initHive` 호출 시점과 `Box` 열림 여부(`Hive.isBoxOpen`)에 대한 런타임 예외 처리를 강화했습니다.
    * **관련 파일/코드**: `_saveLyrics`, `_loadSavedLyrics` 함수 (lib/screens/home_screen.dart), `HiveService` (lib/services/hive_service.dart)

* **전체 가사 붙여넣기**:
    * **테스트 시나리오**: 클립보드의 텍스트가 다이얼로그를 통해 성공적으로 붙여넣어지고, 각 줄이 개별 가사로 파싱되는지 확인했습니다.
    * **결과**: 긴 텍스트 붙여넣기 시 UI 지연 현상이 발생했습니다. 붙여넣기 후 `setState` 호출 전 데이터 처리 시간을 단축하는 방향으로 로직을 최적화했습니다.
    * **관련 파일/코드**: `_showPasteAllLyricsDialog`, `_pasteAllLyrics` 함수 (lib/screens/home_screen.dart)

## 2. 발견된 버그 및 수정 내용 요약

* **오디오 로드 실패**: `just_audio` 라이브러리 버전 호환성 및 특정 코덱 지원 문제 해결.
* **슬라이더 부드럽지 않음**: `StreamBuilder` 데이터 처리 로직 및 `seek` 호출 방식 최적화.
* **가사 수정 후 UI 갱신 문제**: `setState` 호출 누락 및 상태 변수 초기화 로직 보완.
* **가사 하이라이팅/스크롤 깜빡임**: 애니메이션 및 스크롤 로직 미세 조정, 시간 임계값 최적화.
* **Hive 서비스 초기화 시점 예외**: `HiveService.initHive` 호출 시점 및 박스 상태 확인 로직 강화.
* **대용량 가사 붙여넣기 성능**: 텍스트 처리 로직 최적화.

## 3. 향후 계획 (배포 전)

* 추가적인 에지 케이스(Edge Case) 테스트 진행 (예: 네트워크 환경 불안정 시, 권한 거부 시).
* UI/UX 개선점 최종 검토.
* 코드 리팩토링 및 주석 추가로 가독성 향상.
* 성능 프로파일링을 통한 추가 최적화 여부 확인.

---
